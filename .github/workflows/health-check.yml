
name: Health Check
on:
  push:
    branches: [ "master" ]
  workflow_dispatch:

jobs:
  build:
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-22.04, ubuntu-20.04]
        
    runs-on: ${{ matrix.os }}

    steps:
      - uses: actions/checkout@v3
      - name: Install nginx-pagespeed
        run: |
          sudo bash install.sh
          sudo cp pagespeed.conf.sample /etc/nginx/conf.d/pagespeed.conf
        
      - name: Test configuration
        run: |
          sudo systemctl restart nginx
          if [[ ! `sudo nginx -T | grep 'pagespeed on'` ]]; then
            echo "Error: pagespeed is not included";
            exit 1;
          fi
